<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluetooth Device Scanner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        button {
            padding: 10px;
            font-size: 16px;
        }
        ul {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Scan for Bluetooth Devices</h1>
    <button id="scanButton">Scan for Devices</button>
    <ul id="deviceList"></ul>

    <script>
        // Get references to the button and list elements
        const scanButton = document.getElementById('scanButton');
        const deviceList = document.getElementById('deviceList');

        // Function to start scanning for Bluetooth devices
        async function scanForDevices() {
            try {
                // Request the Bluetooth device
                const options = {
                    acceptAllDevices: true,
                    optionalServices: ['device_information']  // Request RSSI service
                };
                
                const device = await navigator.bluetooth.requestDevice(options);

                // Display device info and attempt to retrieve RSSI
                displayDevice(device);
                
                // Connect to the device and read its RSSI value (if supported)
                const server = await device.gatt.connect();
                const rssi = await getDeviceRSSI(device);
                
                if (rssi !== null) {
                    addRSSIInfo(device, rssi);
                } else {
                    addRSSIInfo(device, 'RSSI not available');
                }

            } catch (error) {
                console.error('Error scanning for Bluetooth devices:', error);
            }
        }

        // Function to display device name and ID
        function displayDevice(device) {
            const deviceItem = document.createElement('li');
            deviceItem.textContent = `Device: ${device.name || 'Unknown'} (ID: ${device.id})`;
            deviceList.appendChild(deviceItem);
        }

        // Function to add RSSI info to the list
        function addRSSIInfo(device, rssi) {
            const rssiItem = document.createElement('li');
            rssiItem.textContent = `RSSI: ${rssi}`;
            deviceList.appendChild(rssiItem);
        }

        // Function to retrieve the RSSI value (signal strength)
        async function getDeviceRSSI(device) {
            try {
                // Use device's `gatt` server to access RSSI
                const server = await device.gatt.connect();
                
                // Check if the device supports RSSI (not all devices do)
                if (server.device.rssi) {
                    return server.device.rssi;  // Return RSSI if available
                } else {
                    return null;
                }
            } catch (error) {
                console.error('Error getting RSSI:', error);
                return null;
            }
        }

        // Add event listener to scan button
        scanButton.addEventListener('click', scanForDevices);
    </script>
</body>
</html>
